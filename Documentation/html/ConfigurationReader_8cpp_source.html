<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Virtus: Code/Configure/ConfigurationReader.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Virtus&#160;<span id="projectnumber">Unmarked</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">Code/Configure/ConfigurationReader.cpp</div>  </div>
</div>
<div class="contents">
<a href="ConfigurationReader_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="ConfigurationReader_8h.html">ConfigurationReader.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="ConfigurationFolder_8h.html">ConfigurationFolder.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="ConfigurationString_8h.html">ConfigurationString.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="ConfigurationNumber_8h.html">ConfigurationNumber.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a><a class="code" href="classConfigurationReader.html#abb2a9f4722269a7a473e46f68783da85">00007</a> <span class="keywordtype">void</span> <a class="code" href="classConfigurationReader.html#abb2a9f4722269a7a473e46f68783da85">ConfigurationReader::skipWhitespace</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* node)
<a name="l00008"></a>00008 {
<a name="l00009"></a>00009 
<a name="l00010"></a>00010     <span class="comment">//Create a buffer character to use while skipping any whitespace</span>
<a name="l00011"></a>00011     <span class="keywordtype">int</span> bufferChar = 0;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013     <span class="keywordflow">while</span> (<span class="keyword">true</span>) <span class="comment">//Enter a loop</span>
<a name="l00014"></a>00014     {
<a name="l00015"></a>00015 
<a name="l00016"></a>00016         <span class="comment">//Read the next character from the file</span>
<a name="l00017"></a>00017         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="classDataInputStream.html#a8b8cb01f0ed496122822a082b2666f60">read</a>(&amp;bufferChar, 1) == <span class="keyword">false</span>)
<a name="l00018"></a>00018         {
<a name="l00019"></a>00019             <span class="keywordflow">return</span>;
<a name="l00020"></a>00020         }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <span class="comment">//If the character isn&#39;t a space (isspace returns 0)</span>
<a name="l00023"></a>00023         <span class="keywordflow">if</span> (isspace(bufferChar) == 0)
<a name="l00024"></a>00024         {
<a name="l00025"></a>00025 
<a name="l00026"></a>00026             <span class="comment">//Rewind 1 byte</span>
<a name="l00027"></a>00027             node-&gt;<a class="code" href="classDataInputStream.html#afa9093ed850b8013fd4e4e52a0e7aacd">rewind</a>(1);
<a name="l00028"></a>00028 
<a name="l00029"></a>00029             <span class="keywordflow">return</span>;
<a name="l00030"></a>00030         }
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">//Keep reading until file ends or a &quot; is found and add each character read onto the output buffer. If end of the file return fail</span>
<a name="l00038"></a><a class="code" href="classConfigurationReader.html#a5851f08ea5219a3ea5d6663b74526f0f">00038</a> <span class="keywordtype">bool</span> <a class="code" href="classConfigurationReader.html#a5851f08ea5219a3ea5d6663b74526f0f">ConfigurationReader::getString</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* stream, <span class="keywordtype">char</span>* outputBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mlen)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040     <span class="comment">//The buffer character used in the reading of the string</span>
<a name="l00041"></a>00041     <span class="keywordtype">int</span> bufferChar = 0;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     <span class="comment">//The pointer to the current index in the output buffer</span>
<a name="l00044"></a>00044     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cPtr = 0;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="comment">//Start looping</span>
<a name="l00047"></a>00047     <span class="keywordflow">while</span> (<span class="keyword">true</span>)
<a name="l00048"></a>00048     {
<a name="l00049"></a>00049         <span class="comment">//If unable to get the next character</span>
<a name="l00050"></a>00050         <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="classDataInputStream.html#a8b8cb01f0ed496122822a082b2666f60">read</a>(&amp;bufferChar, 1) == <span class="keyword">false</span>)
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052 
<a name="l00053"></a>00053             <span class="comment">//Exit with an error</span>
<a name="l00054"></a>00054             printf(<span class="stringliteral">&quot;Error end of file before string ends\n&quot;</span>);
<a name="l00055"></a>00055             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         <span class="comment">//If its a terminating character append a null terminator to the end of the string and exit with a success value</span>
<a name="l00060"></a>00060         <span class="keywordflow">if</span> ((bufferChar == L<span class="charliteral">&#39;&quot;&#39;</span>))
<a name="l00061"></a>00061         {
<a name="l00062"></a>00062             <span class="comment">//Check not outside the output bounds</span>
<a name="l00063"></a>00063             <span class="keywordflow">if</span> (cPtr &gt;= mlen) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065             <span class="comment">//Append the null terminator</span>
<a name="l00066"></a>00066             outputBuffer[cPtr] = L<span class="charliteral">&#39;\0&#39;</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068             <span class="comment">//Return true</span>
<a name="l00069"></a>00069             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="comment">//Check not outside the bounds</span>
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (cPtr &gt;= mlen) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">//Add the read character to the current point on the output buffer</span>
<a name="l00077"></a>00077         outputBuffer[cPtr] = bufferChar;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="comment">//Increment the current pointer</span>
<a name="l00080"></a>00080         cPtr++;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">//Should never get here</span>
<a name="l00085"></a>00085     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">//WORDS IN CONFIGURATION, Any space seperated value E.g. dog, anything in a set of quotes is interpretted as a single word IE \&quot;Hello World\&quot; and the symbols {, } and ; are interpretted as single words</span>
<a name="l00090"></a><a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">00090</a> <span class="keywordtype">bool</span> <a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">ConfigurationReader::getNextWord</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* instream, <span class="keywordtype">char</span>* outputBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mlen)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">//Buffer character used when reading the next word</span>
<a name="l00094"></a>00094     <span class="keywordtype">int</span> bufferChar = 0;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     <span class="comment">//Pointer to the current location in the outputBuffer</span>
<a name="l00097"></a>00097     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cPtr = 0;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">//Skip all the whitespace before the next word</span>
<a name="l00100"></a>00100     <a class="code" href="classConfigurationReader.html#abb2a9f4722269a7a473e46f68783da85">skipWhitespace</a>(instream);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment">//Enter a loop</span>
<a name="l00103"></a>00103     <span class="keywordflow">while</span> (<span class="keyword">true</span>)
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="comment">//If the read fails or the character is a space then exit appending a null terminator to the string</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="keywordtype">bool</span> resultOfRead = instream-&gt;<a class="code" href="classDataInputStream.html#a8b8cb01f0ed496122822a082b2666f60">read</a>(&amp;bufferChar, 1);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="keywordflow">if</span> ( (resultOfRead == <span class="keyword">false</span>) || (isspace(bufferChar) != 0))
<a name="l00111"></a>00111         {
<a name="l00112"></a>00112 
<a name="l00113"></a>00113             <span class="comment">//Check we can still add to the buffer</span>
<a name="l00114"></a>00114             <span class="keywordflow">if</span> (cPtr &gt;= mlen) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116             <span class="comment">//Append a null</span>
<a name="l00117"></a>00117             outputBuffer[cPtr] = L<span class="charliteral">&#39;\0&#39;</span>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119             <span class="comment">//Return success</span>
<a name="l00120"></a>00120             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="comment">//Check if its a &quot; and its the start of a word (No characters beforehand, If its not it will be picked up later and the world will unget the character then kick out (As its the start of the next word probably, just a badly written file)</span>
<a name="l00125"></a>00125         <span class="keywordflow">if</span> (bufferChar == L<span class="charliteral">&#39;&quot;&#39;</span>)
<a name="l00126"></a>00126         {
<a name="l00127"></a>00127             <span class="keywordflow">if</span> (cPtr == 0)
<a name="l00128"></a>00128                 <span class="comment">//If at the start, pass to a readString</span>
<a name="l00129"></a>00129                 <span class="keywordflow">return</span> <a class="code" href="classConfigurationReader.html#a5851f08ea5219a3ea5d6663b74526f0f">getString</a>(instream, outputBuffer, mlen);
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="comment">//These tests come after adding the character to the buffer (AS they wouldn&#39;t be added to the word otherwise)</span>
<a name="l00133"></a>00133         <span class="keywordflow">if</span> ((bufferChar == L<span class="charliteral">&#39;{&#39;</span>) || (bufferChar == L<span class="charliteral">&#39;}&#39;</span>) || (bufferChar == L<span class="charliteral">&#39;;&#39;</span>) || (bufferChar == L<span class="charliteral">&#39;&quot;&#39;</span>))
<a name="l00134"></a>00134         {
<a name="l00135"></a>00135 
<a name="l00136"></a>00136             <span class="comment">//If this isn&#39;t the first character read then its a badly written Cfg file with no whitespace between the words. unget the character and exit out</span>
<a name="l00137"></a>00137             <span class="keywordflow">if</span> (cPtr != 0)
<a name="l00138"></a>00138             {
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                 <span class="comment">//Unget the character so the next getNextWord functions correctly (Push it back onto the file stream)</span>
<a name="l00141"></a>00141                 instream-&gt;<a class="code" href="classDataInputStream.html#afa9093ed850b8013fd4e4e52a0e7aacd">rewind</a>(1);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                 <span class="comment">//Check we can still add to the buffer</span>
<a name="l00144"></a>00144                 <span class="keywordflow">if</span> (cPtr &gt;= mlen) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146                 <span class="comment">//Append a null terminator onto the end</span>
<a name="l00147"></a>00147                 outputBuffer[cPtr] = L<span class="charliteral">&#39;\0&#39;</span>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149                 <span class="comment">//Return success</span>
<a name="l00150"></a>00150                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152             }
<a name="l00153"></a>00153             <span class="comment">//If it is the first character however, then it is the entirety of the word and thus just append the character plus a null terminator to the output buffer and exit out</span>
<a name="l00154"></a>00154             <span class="keywordflow">else</span>
<a name="l00155"></a>00155             {
<a name="l00156"></a>00156 
<a name="l00157"></a>00157                 <span class="comment">//Check we can still add to the buffer (mlen - 1 as adding two characters)</span>
<a name="l00158"></a>00158                 <span class="keywordflow">if</span> (cPtr &gt;= mlen - 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                 <span class="comment">//Append the character</span>
<a name="l00161"></a>00161                 outputBuffer[cPtr] = bufferChar;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163                 <span class="comment">//Append a null terminator</span>
<a name="l00164"></a>00164                 outputBuffer[cPtr + 1] = L<span class="charliteral">&#39;\0&#39;</span>;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166                 <span class="comment">//Return success</span>
<a name="l00167"></a>00167                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="comment">//If its none of those things, then just stick the character onto the end of the output buffer and restart the loop!</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="comment">//Check can still fit more on the buffer</span>
<a name="l00175"></a>00175         <span class="keywordflow">if</span> (cPtr &gt;= mlen)
<a name="l00176"></a>00176         {
<a name="l00177"></a>00177             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">//Append it onto the end of the output buffer</span>
<a name="l00181"></a>00181         outputBuffer[cPtr] = bufferChar;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="comment">//Increment the current pointer</span>
<a name="l00184"></a>00184         cPtr++;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="comment">//Shouldn&#39;t ever reach here!</span>
<a name="l00188"></a>00188     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="classConfigurationReader.html#a27c8efc74e7f945dc0aa60a92a3f2c95">00191</a> <a class="code" href="classConfigurationNode.html">ConfigurationNode</a>* <a class="code" href="classConfigurationReader.html#a27c8efc74e7f945dc0aa60a92a3f2c95">ConfigurationReader::readFolderNode</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* node)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">//Create a buffer for the name of the folder (And the subsequent read to check its formatted properly with a {</span>
<a name="l00195"></a>00195     <span class="keywordtype">char</span> nameBuffer[512] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">//Attempt to read the name</span>
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, nameBuffer, 512) == <span class="keyword">false</span>)
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200         printf(<span class="stringliteral">&quot;Unable to read folder name\n&quot;</span>);
<a name="l00201"></a>00201         <span class="keywordflow">return</span> 0;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="comment">//Create the new folder with the name that was read</span>
<a name="l00205"></a>00205     <a class="code" href="classConfigurationFolder.html" title="A implementation of a configuration folder, it has a number of children pointers to them and a name...">ConfigurationFolder</a>* newFolder = <span class="keyword">new</span> <a class="code" href="classConfigurationFolder.html" title="A implementation of a configuration folder, it has a number of children pointers to them and a name...">ConfigurationFolder</a>(nameBuffer);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="comment">//Try and read the {</span>
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, nameBuffer, 512) == <span class="keyword">false</span>)
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         printf(<span class="stringliteral">&quot;Error in config file\n&quot;</span>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keyword">delete</span> newFolder;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <span class="keywordflow">return</span> 0;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">//Check its a { otherwise return a error</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;{&quot;</span>, nameBuffer) != 0)
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         printf(<span class="stringliteral">&quot;Error, expected { after name in configuration file&quot;</span>);
<a name="l00221"></a>00221         <span class="keyword">delete</span> newFolder;
<a name="l00222"></a>00222         <span class="keywordflow">return</span> 0;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="comment">//Pointer to the next childNode when reading the children</span>
<a name="l00226"></a>00226     <a class="code" href="classConfigurationNode.html">ConfigurationNode</a>* childNode = 0;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">//Here&#39;s a little bit of trickery. Loop calling getNextNode until it returns 0. this works because the folder is ended with } which will cause getNextNode to return 0 when it reads it as the next word.</span>
<a name="l00229"></a>00229     <span class="keywordflow">while</span> (1)
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="comment">//Attempt to get the next node</span>
<a name="l00233"></a>00233         childNode = <a class="code" href="classConfigurationReader.html#ae9804c7377ebc2c0d43b34a1dde21ef1">getNextNode</a>(node);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="comment">//If its 0, theres either been a error or a } has been found. either way break out and return</span>
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (childNode == 0)
<a name="l00237"></a>00237         {
<a name="l00238"></a>00238             <span class="keywordflow">break</span>;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240         <span class="keywordflow">else</span>
<a name="l00241"></a>00241         {
<a name="l00242"></a>00242 
<a name="l00243"></a>00243             <span class="comment">//Otherwise, just add it as a child node</span>
<a name="l00244"></a>00244             newFolder-&gt;<a class="code" href="classConfigurationFolder.html#a0239e0fee7aabfd8f01f45c06c2d9f89" title="Add the specified child to this node.">addChild</a>(childNode);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="comment">//Return the generated folder</span>
<a name="l00251"></a>00251     <span class="keywordflow">return</span> newFolder;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a><a class="code" href="classConfigurationReader.html#abb2f9e2ed8b541c988cdb7e8ad021694">00254</a> <a class="code" href="classConfigurationNode.html">ConfigurationNode</a>* <a class="code" href="classConfigurationReader.html#abb2f9e2ed8b541c988cdb7e8ad021694">ConfigurationReader::readStringNode</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* node)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256     <span class="keywordtype">char</span> nameBuffer[512] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00257"></a>00257     <span class="keywordtype">char</span> stringBuffer[2048] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="comment">//Attempt to read the string name</span>
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, nameBuffer, 512) == <span class="keyword">false</span>)
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         printf(<span class="stringliteral">&quot;Unable to read string name\n&quot;</span>);
<a name="l00263"></a>00263         <span class="keywordflow">return</span> 0;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">//Read the next word into the string buffer, if it fails return 0</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, stringBuffer, 2028) == <span class="keyword">false</span>)
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         printf(<span class="stringliteral">&quot;Bad configuration file\n&quot;</span>);
<a name="l00271"></a>00271         <span class="keywordflow">return</span> 0;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">//check its a =, it should be a equals, if not have a bit of a shout and return 0</span>
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (strcmp(stringBuffer, <span class="stringliteral">&quot;=&quot;</span>) != 0)
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         printf(<span class="stringliteral">&quot;Expecting equals after name in string definition.\n&quot;</span>);
<a name="l00280"></a>00280         <span class="keywordflow">return</span> 0;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">//Attempt to read the string name, (Comes after the equals, duh) if it fails return 0</span>
<a name="l00285"></a>00285     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, stringBuffer, 2048) == <span class="keyword">false</span>)
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         printf(<span class="stringliteral">&quot;Unable to read string name\n&quot;</span>);
<a name="l00289"></a>00289         <span class="keywordflow">return</span> 0;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="comment">//Create the actual node, a new string</span>
<a name="l00294"></a>00294     <a class="code" href="classConfigurationString.html">ConfigurationString</a>* newString = <span class="keyword">new</span> <a class="code" href="classConfigurationString.html">ConfigurationString</a>(nameBuffer, stringBuffer);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">//Attempt to read the next word, if it fails then theres no ; so delete the nice new node we just created and return nil after complaining</span>
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, stringBuffer, 2048) == <span class="keyword">false</span>)
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         printf(<span class="stringliteral">&quot;Bad cfg file\n&quot;</span>);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keyword">delete</span> newString;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="keywordflow">return</span> 0;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="comment">//Check its a ;, if it isn&#39;t complain a bit then delete the nice new node and return 0;</span>
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (strcmp(stringBuffer, <span class="stringliteral">&quot;;&quot;</span>) != 0)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311 
<a name="l00312"></a>00312         printf(<span class="stringliteral">&quot;Expecting ; terminator after string value recieved %s instead\n&quot;</span>, nameBuffer);
<a name="l00313"></a>00313         <span class="keyword">delete</span> newString;
<a name="l00314"></a>00314         <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="comment">//Finally if nothing goes wrong return the string</span>
<a name="l00319"></a>00319     <span class="keywordflow">return</span> newString;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="classConfigurationReader.html#a2a48bf808f8bf921452254d68b473eac">00322</a> <a class="code" href="classConfigurationNode.html">ConfigurationNode</a>* <a class="code" href="classConfigurationReader.html#a2a48bf808f8bf921452254d68b473eac">ConfigurationReader::readNumberNode</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* node)
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="comment">//Create a value float and a buffer for the node name</span>
<a name="l00326"></a>00326     <span class="keywordtype">char</span> nameBuffer[512] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">//Small because once you&#39;ve got 256 digits in a float I doubt its gohna work anyways</span>
<a name="l00329"></a>00329     <span class="keywordtype">char</span> numberBuffer[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordtype">float</span> value = 0;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <span class="comment">//If unable to read the number node&#39;s name exit out with a unhappy face</span>
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, nameBuffer, 512) == <span class="keyword">false</span>)
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336         printf(<span class="stringliteral">&quot;Unable to read number name\n&quot;</span>);
<a name="l00337"></a>00337         <span class="keywordflow">return</span> 0;
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="comment">//If unable to read the next word (Should be a =) exit out with a grumble</span>
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, numberBuffer, 256) == <span class="keyword">false</span>)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         printf(<span class="stringliteral">&quot;Bad configuration file\n&quot;</span>);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="keywordflow">return</span> 0;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">//If the next word wasn&#39;t in fact a = then have a even bigger rant and exit</span>
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (strcmp(numberBuffer, <span class="stringliteral">&quot;=&quot;</span>) != 0)
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         printf(<span class="stringliteral">&quot;Expecting equals after name in number definition.\n&quot;</span>);
<a name="l00355"></a>00355         <span class="keywordflow">return</span> 0;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="comment">//Attempt to read the actual number as a string</span>
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, numberBuffer, 256) == <span class="keyword">false</span>)
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362         printf(<span class="stringliteral">&quot;Unable to read number name\n&quot;</span>);
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <span class="comment">//Attempt to scan it from the string using swscanf</span>
<a name="l00366"></a>00366     <span class="keywordflow">if</span> (sscanf(numberBuffer, <span class="stringliteral">&quot;%f&quot;</span>, &amp;value) != 1)
<a name="l00367"></a>00367     {
<a name="l00368"></a>00368         printf(<span class="stringliteral">&quot;Unable to evaluate to a number value\n&quot;</span>);
<a name="l00369"></a>00369         <span class="keywordflow">return</span> 0;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="comment">//Create the new number using the namebuffer and the value</span>
<a name="l00373"></a>00373     <a class="code" href="classConfigurationNumber.html">ConfigurationNumber</a>* newNumber = <span class="keyword">new</span> <a class="code" href="classConfigurationNumber.html">ConfigurationNumber</a>(nameBuffer, value);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">//If unable to read the next word (Should be a ;) throw a hissy fit and return 0</span>
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, nameBuffer, 256) == <span class="keyword">false</span>)
<a name="l00377"></a>00377     {
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         printf(<span class="stringliteral">&quot;Bad cfg file\n&quot;</span>);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keyword">delete</span> newNumber;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordflow">return</span> 0;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="comment">//If the next word isn&#39;t a ; then complain and return 0</span>
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (strcmp(nameBuffer, <span class="stringliteral">&quot;;&quot;</span>) != 0)
<a name="l00389"></a>00389     {
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         printf(<span class="stringliteral">&quot;Expecting ; terminator after number value\n&quot;</span>);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="keyword">delete</span> newNumber;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <span class="keywordflow">return</span> 0;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="comment">//If nothing went wrong then return the new number!</span>
<a name="l00400"></a>00400     <span class="keywordflow">return</span> newNumber;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="classConfigurationReader.html#ae9804c7377ebc2c0d43b34a1dde21ef1">00404</a> <a class="code" href="classConfigurationNode.html">ConfigurationNode</a>* <a class="code" href="classConfigurationReader.html#ae9804c7377ebc2c0d43b34a1dde21ef1">ConfigurationReader::getNextNode</a>(<a class="code" href="classDataInputStream.html">DataInputStream</a>* node)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <span class="comment">//Create a buffer to use when reading the words from the file</span>
<a name="l00407"></a>00407     <span class="keywordtype">char</span> cfgBuffer[1024] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">//If the next word fails to read, just return null (Failure)</span>
<a name="l00410"></a>00410     <span class="keywordflow">if</span> (<a class="code" href="classConfigurationReader.html#a8094d63cdaa2e98b6a0cb2924dbe96db">getNextWord</a>(node, cfgBuffer, 1024) == <span class="keyword">false</span>)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412         printf(<span class="stringliteral">&quot;ConfigurationReader: Unable to read next word\n&quot;</span>);
<a name="l00413"></a>00413         <span class="keywordflow">return</span> 0;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="comment">//If its a folder this is how its parsedCiao</span>
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (strcmp(cfgBuffer, <span class="stringliteral">&quot;folder&quot;</span>) == 0)
<a name="l00418"></a>00418     {
<a name="l00419"></a>00419         printf(<span class="stringliteral">&quot;ConfigurationReader: Attempting to read a folder node\n&quot;</span>);
<a name="l00420"></a>00420         <span class="comment">//Pass it on to the specific read function</span>
<a name="l00421"></a>00421         <span class="keywordflow">return</span> <a class="code" href="classConfigurationReader.html#a27c8efc74e7f945dc0aa60a92a3f2c95">readFolderNode</a>(node);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424     <span class="comment">//If its a string this is how its parsed</span>
<a name="l00425"></a>00425     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(cfgBuffer, <span class="stringliteral">&quot;string&quot;</span>) == 0)
<a name="l00426"></a>00426     {
<a name="l00427"></a>00427         printf(<span class="stringliteral">&quot;ConfigurationReader: Attempting to read a string node\n&quot;</span>);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="comment">//Pass it on to the specific read function</span>
<a name="l00430"></a>00430         <span class="keywordflow">return</span> <a class="code" href="classConfigurationReader.html#abb2f9e2ed8b541c988cdb7e8ad021694">readStringNode</a>(node);
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(cfgBuffer, <span class="stringliteral">&quot;number&quot;</span>) == 0)
<a name="l00433"></a>00433     {
<a name="l00434"></a>00434         printf(<span class="stringliteral">&quot;ConfigurationReader: Attempting to read a number\n&quot;</span>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="comment">//Pass it on to the specific number read function</span>
<a name="l00437"></a>00437         <span class="keywordflow">return</span> <a class="code" href="classConfigurationReader.html#a2a48bf808f8bf921452254d68b473eac">readNumberNode</a>(node);
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439     <span class="keywordflow">else</span>
<a name="l00440"></a>00440     {
<a name="l00441"></a>00441         printf(<span class="stringliteral">&quot;ConfigurationReader: Unknown node %s\n&quot;</span>, cfgBuffer);
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     <span class="keywordflow">return</span> 0;
<a name="l00445"></a>00445 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 31 2011 12:51:18 for Virtus by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
